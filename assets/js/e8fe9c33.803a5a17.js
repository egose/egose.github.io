"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4731],{7168:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>m,contentTitle:()=>c,default:()=>f,frontMatter:()=>u,metadata:()=>p,toc:()=>h});var r=s(5893),t=s(1151),i=s(4866),o=s(5162),a=s(9286);const d="import {\n  // class decorator\n  Router,\n  // method decorators\n  DocPermissions,\n  BaseFilter,\n  Validate,\n  Prepare,\n  Transform,\n  Decorate,\n  DecorateAll,\n  RouteGuard,\n  // parameter decorators\n  Request,\n  Document,\n  Permissions,\n  Context,\n  // property decorator\n  Option,\n} from '@egose/deco';\n\n@Router('User')\nexport class UserRouter {\n  @Option() routeGuard = {\n    list: true,\n    read: true,\n    update: true,\n    delete: 'isAdmin',\n    create: ['isAdmin', 'dummy'],\n    subs: {\n      statusHistory: {\n        list: true,\n        read: true,\n        update: true,\n        delete: 'isAdmin',\n        create: 'isAdmin',\n      },\n    },\n  };\n\n  @Option() permissionSchema = {\n    name: {\n      list: true,\n      read: true,\n      update: ['edit.name', 'edit.dummy'],\n      create: true,\n    },\n    role: {\n      list: 'isAdmin',\n      read: true,\n      update: 'edit.role',\n      create: 'isAdmin',\n    },\n    public: {\n      list: false,\n      read: true,\n      update: 'edit.public',\n      create: true,\n    },\n    statusHistory: {\n      list: (permissions) => {\n        return false;\n      },\n      read: (permissions) => {\n        return permissions.isAdmin;\n      },\n      update: (permissions, modelPermissions) => {\n        return modelPermissions['edit.statusHistory'];\n      },\n      sub: {\n        name: { list: true, read: true, update: true, create: true },\n        approved: { list: true, read: true, update: false, create: true },\n        document: { list: false, read: true, update: true, create: true },\n      },\n    },\n    orgs: { list: true, read: true, update: 'edit.orgs', create: true },\n  };\n\n  @Option() basePath = null;\n\n  @Option() identifier = (id) => {\n    return { name: id };\n  };\n\n  @Option('baseFilter.subs') baseFilterSubs = {\n    statusHistory: {\n      list: (permissions) => {\n        if (permissions.isAdmin) return {};\n        else return { approved: true };\n      },\n      read: (permissions) => {\n        if (permissions.isAdmin) return {};\n        else return { approved: true };\n      },\n      update: (permissions) => {\n        if (permissions.isAdmin) return {};\n        else return false;\n      },\n      delete: (permissions) => {\n        if (permissions.isAdmin) return {};\n        else return false;\n      },\n    },\n  };\n\n  @DocPermissions('default')\n  docPermissions(@Request() req, @Document() doc, @Permissions() permissions) {\n    const isMe = String(doc._id) === String(req._user?._id);\n    const p = {\n      'edit.name': permissions.isAdmin || isMe,\n      'edit.role': permissions.isAdmin,\n      'edit.public': permissions.isAdmin,\n      'edit.statusHistory': permissions.isAdmin,\n      'edit.orgs': permissions.isAdmin,\n      'test:public': doc.public,\n    };\n\n    return p;\n  }\n\n  @BaseFilter('list')\n  listBaseFilter(@Request() req, @Permissions() permissions) {\n    if (permissions.isAdmin) return {};\n    else return { $or: [{ _id: req._user?._id }, { public: true }] };\n  }\n\n  @BaseFilter('read')\n  readBaseFilter(@Request() req, @Permissions() permissions) {\n    if (permissions.isAdmin) return {};\n    else return { _id: req._user?._id };\n  }\n\n  @BaseFilter('update')\n  updateBaseFilter(@Request() req, @Permissions() permissions) {\n    if (permissions.isAdmin) return {};\n    else return { _id: req._user?._id };\n  }\n\n  @BaseFilter('delete')\n  deleteBaseFilter(@Request() req, @Permissions() permissions) {\n    if (permissions.isAdmin) return {};\n    else return { _id: req._user?._id };\n  }\n\n  @Decorate('create')\n  addCreatedBy(@Document() doc) {\n    doc._createdBy = 'egose';\n    return doc;\n  }\n}\n",l="import mongoose from 'mongoose';\nimport { RootRouter } from './root.router';\nimport { UserRouter } from './user.router';\nimport { OrgRouter } from './org.router';\nimport { Module, Option, GlobalPermissions, Request } from '@egose/deco';\n\n@Module({\n  routers: [RootRouter, UserRouter, OrgRouter],\n  options: { basePath: '/api' },\n})\nexport class RoutersModule {\n  @Option() permissionField = '_permissions';\n\n  @GlobalPermissions()\n  async globalPermissions(@Request() req) {\n    const User = mongoose.model('User');\n    const userName = req.headers.user;\n\n    let user;\n    if (userName) {\n      user = await User.findOne({ name: userName });\n    }\n\n    req._user = user;\n    return { isAdmin: user?.role === 'admin' };\n  }\n}\n",u={sidebar_label:"Quick Start",sidebar_position:1},c="Quick Start",p={id:"egose-deco/quick-start",title:"Quick Start",description:"Before proceeding, make sure to install express, mongoose and reflect-metadata as peer dependencies. These packages are required for the proper functioning of the application and must be installed prior to running the code. You can install them using the npm package manager.",source:"@site/docs/egose-deco/quick-start.md",sourceDirName:"egose-deco",slug:"/egose-deco/quick-start",permalink:"/docs/egose-deco/quick-start",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_label:"Quick Start",sidebar_position:1},sidebar:"decoSidebar",previous:{title:"Philosophy",permalink:"/docs/egose-deco/philosophy"}},m={},h=[{value:"Installation",id:"installation",level:2},{value:"Backend Configuration",id:"backend-configuration",level:2},{value:"Model Router",id:"model-router",level:3},{value:"Router Module",id:"router-module",level:3},{value:"Bootstrapping the Module in an Express Server",id:"bootstrapping-the-module-in-an-express-server",level:3}];function g(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"quick-start",children:"Quick Start"})}),"\n","\n",(0,r.jsxs)(n.p,{children:["Before proceeding, make sure to install ",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/express",children:(0,r.jsx)(n.code,{children:"express"})}),", ",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/mongoose",children:(0,r.jsx)(n.code,{children:"mongoose"})})," and ",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/reflect-metadata",children:(0,r.jsx)(n.code,{children:"reflect-metadata"})})," as peer dependencies. These packages are required for the proper functioning of the application and must be installed prior to running the code. You can install them using the npm package manager."]}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsxs)(i.Z,{groupId:"npm2yarn",children:[(0,r.jsx)(o.Z,{value:"npm",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install express mongoose @egose/deco\nnpm install @types/express reflect-metadata --save-dev\n"})})}),(0,r.jsx)(o.Z,{value:"yarn",label:"Yarn",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yarn add express mongoose @egose/deco\nyarn add @types/express reflect-metadata --dev\n"})})}),(0,r.jsx)(o.Z,{value:"pnpm",label:"pnpm",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pnpm add express mongoose @egose/deco\npnpm add @types/express reflect-metadata --save-dev\n"})})})]}),"\n",(0,r.jsx)(n.h2,{id:"backend-configuration",children:"Backend Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"model-router",children:"Model Router"}),"\n",(0,r.jsxs)(n.p,{children:["Using the ",(0,r.jsx)(n.code,{children:"Router"})," class decorator, you can define a model router class and specify various options and middleware functions with ",(0,r.jsx)(n.code,{children:"annotations"}),". This approach helps to encapsulate and organize the routing logic for a given model, making the code more modular and easier to understand."]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n","\n",(0,r.jsx)(a.Z,{language:"ts",children:d}),"\n",(0,r.jsx)(n.h3,{id:"router-module",children:"Router Module"}),"\n",(0,r.jsxs)(n.p,{children:["After defining one or more model routers, you can use the ",(0,r.jsx)(n.code,{children:"Module"})," class decorator to create an Egose Module that includes these routers. Within the ",(0,r.jsx)(n.code,{children:"Egose Module"}),", you can also define the ",(0,r.jsx)(n.code,{children:"Global Permissions"})," function, which provides the user context to each model's middleware functions. This approach helps to organize the routers in a hierarchical structure, making the code more modular and easier to understand. By leveraging the Module decorator, developers can create a centralized location for defining global permissions and integrating them across all of the model routers in their application."]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n","\n",(0,r.jsx)(a.Z,{language:"ts",children:l}),"\n",(0,r.jsx)(n.h3,{id:"bootstrapping-the-module-in-an-express-server",children:"Bootstrapping the Module in an Express Server"}),"\n",(0,r.jsxs)(n.p,{children:["Once you have defined the router module, you can bootstrap the API endpoints with the Express server. This involves encapsulating the Express routes within the module definition, which helps to ensure that the routing logic is properly organized and modularized. By leveraging the ",(0,r.jsx)(n.code,{children:"bootstrap"})," function in the Egose library, developers can easily integrate their router modules with an Express server and start listening for incoming requests."]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import express from 'express';\nimport { EgoseFactory } from '@egose/deco';\n\nconst app = express();\nEgoseFactory.bootstrap(RoutersModule, app);\n"})})]})}function f(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(g,{...e})}):g(e)}}}]);