"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1272],{4473:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});var n=s(5893),c=s(1151);s(4866),s(5162),s(9286);const l={sidebar_position:2},r="Create",t={id:"egose-acl/crud-lifecycle/create",title:"Create",description:"Create operation executes hook methods in the following sequence:",source:"@site/docs/egose-acl/crud-lifecycle/create.mdx",sourceDirName:"egose-acl/crud-lifecycle",slug:"/egose-acl/crud-lifecycle/create",permalink:"/docs/egose-acl/crud-lifecycle/create",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"aclSidebar",previous:{title:"Read",permalink:"/docs/egose-acl/crud-lifecycle/read"},next:{title:"Update",permalink:"/docs/egose-acl/crud-lifecycle/update"}},d={},o=[{value:"Configuration Example",id:"configuration-example",level:3}];function a(e){const i={code:"code",h1:"h1",h3:"h3",p:"p",pre:"pre",...(0,c.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h1,{id:"create",children:"Create"}),"\n","\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"Create"})," operation executes hook methods in the following sequence:"]}),"\n",(0,n.jsxs)("table",{children:[(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Hook"}),(0,n.jsx)("th",{children:"Parameters"}),(0,n.jsx)("th",{children:"Description"})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"validate"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("ol",{children:[(0,n.jsx)("li",{children:"allowed data object"}),(0,n.jsx)("li",{children:"global permissions"}),(0,n.jsxs)("li",{children:["context object:",(0,n.jsx)("ul",{children:(0,n.jsx)("li",{children:"originalData"})})]})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("ul",{})})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"prepare"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("ol",{children:[(0,n.jsx)("li",{children:"allowed data object"}),(0,n.jsx)("li",{children:"global permissions"}),(0,n.jsxs)("li",{children:["context object:",(0,n.jsx)("ul",{children:(0,n.jsx)("li",{children:"originalData"})})]})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("ul",{})})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"docPermissions"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("ol",{children:[(0,n.jsx)("li",{children:"Mongoose document"}),(0,n.jsx)("li",{children:"global permissions"}),(0,n.jsxs)("li",{children:["context object:",(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"originalData"}),(0,n.jsx)("li",{children:"preparedData"})]})]})]})}),(0,n.jsx)("td",{children:(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:["skips if option ",(0,n.jsx)("code",{children:"includePermissions"})," set to ",(0,n.jsx)("code",{children:"false"})]}),(0,n.jsx)("li",{children:"called after a Mongoose document created"})]})})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"decorate"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("ol",{children:[(0,n.jsx)("li",{children:"plain document object"}),(0,n.jsx)("li",{children:"global permissions"}),(0,n.jsxs)("li",{children:["context object:",(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"originalData"}),(0,n.jsx)("li",{children:"preparedData"})]})]})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("ul",{})})]})]}),"\n",(0,n.jsx)(i.h3,{id:"configuration-example",children:"Configuration Example"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-ts",children:"modelRouter.validate('create', function (dataObject, globalPermissions) {\n  const hasName = !!dataObject.name;\n  return hasName;\n});\n\nmodelRouter.prepare('create', function (dataObject, globalPermissions) {\n  dataObject.name = dataObject.name.trim();\n  return dataObject;\n});\n\nmodelRouter.docPermissions('create', function (doc, globalPermissions) {\n  const isMe = String(doc._id) === String(this.user._id);\n\n  return {\n    'edit.name': globalPermissions.isAdmin || isMe,\n    'edit.role': globalPermissions.isAdmin,\n  };\n});\n\nmodelRouter.decorate('create', function (docObject, globalPermissions) {\n  docObject.decoratedBy = 'egose';\n  return docObject;\n});\n"})})]})}function h(e={}){const{wrapper:i}={...(0,c.a)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}}}]);