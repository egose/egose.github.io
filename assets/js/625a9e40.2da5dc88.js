"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5200],{1134:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>d,toc:()=>l});var t=n(5893),o=n(1151);n(4866),n(5162),n(9286);const r={sidebar_position:2},i="Model Router Options",d={id:"egose-acl/options/model-options",title:"Model Router Options",description:"Options for Model Routers",source:"@site/docs/egose-acl/options/model-options.mdx",sourceDirName:"egose-acl/options",slug:"/egose-acl/options/model-options",permalink:"/docs/egose-acl/options/model-options",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"aclSidebar",previous:{title:"Default Model Router Options",permalink:"/docs/egose-acl/options/default-model-options"},next:{title:"Model Middleware",permalink:"/docs/egose-acl/options/model-middleware"}},a={},l=[{value:"Options for Model Routers",id:"options-for-model-routers",level:2},{value:"basePath",id:"basepath",level:3},{value:"parentPath",id:"parentpath",level:3},{value:"queryPath",id:"querypath",level:3},{value:"mutationPath",id:"mutationpath",level:3},{value:"idParam",id:"idparam",level:3},{value:"listHardLimit",id:"listhardlimit",level:3},{value:"permissionField",id:"permissionfield",level:3},{value:"mandatoryFields",id:"mandatoryfields",level:3},{value:"identifier",id:"identifier",level:3},{value:"permissionSchema",id:"permissionschema",level:3},{value:"docPermissions",id:"docpermissions",level:3},{value:"routeGuard",id:"routeguard",level:3},{value:"baseFilter",id:"basefilter",level:3},{value:"defaults",id:"defaults",level:3}];function u(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"model-router-options",children:"Model Router Options"})}),"\n","\n",(0,t.jsx)(s.h2,{id:"options-for-model-routers",children:"Options for Model Routers"}),"\n",(0,t.jsx)(s.p,{children:"Model router options refer to the specific options that are applied to an individual model router. These options can be provided either to the instance constructor or to individual setter methods."}),"\n",(0,t.jsx)(s.h3,{id:"basepath",children:"basePath"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"basePath"})," option sets the base URL path for the routes used by the Mongoose Model."]}),"\n",(0,t.jsxs)(s.p,{children:["It is only applicable when creating the model router and can be passed as an option object to the ",(0,t.jsx)(s.code,{children:"createRouter()"})," method."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst userRouter = egose.createRouter('User', { basePath: '/users' });\n"})}),"\n",(0,t.jsx)(s.h3,{id:"parentpath",children:"parentPath"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"parentPath"})," option is a configuration setting that allows you to specify the path name between the ",(0,t.jsx)(s.code,{children:"host"})," and the ",(0,t.jsx)(s.code,{children:"basePath"})," for each model router. This option is used to build the full path for each router. This option is only applicable when creating a model router and will use the value from the ",(0,t.jsx)(s.a,{href:"/docs/egose-acl/options/default-model-options/#parentpath",children:(0,t.jsx)(s.code,{children:"default model router options - parentPath"})})," if it is not explicitly defined."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst userRouter = egose.createRouter('User', { parentPath: '/api' });\n"})}),"\n",(0,t.jsx)(s.h3,{id:"querypath",children:"queryPath"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"queryPath"})," option is used to specify the path name (suffix) for ",(0,t.jsx)(s.code,{children:"Advanced View Routes"}),". This option is only applicable when creating a model router and will use the value from the ",(0,t.jsx)(s.a,{href:"/docs/egose-acl/options/default-model-options/#querypath",children:(0,t.jsx)(s.code,{children:"default model router options - queryPath"})})," if it is not explicitly defined."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst userRouter = egose.createRouter('User', { queryPath: '__q__' });\n"})}),"\n",(0,t.jsx)(s.h3,{id:"mutationpath",children:"mutationPath"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"mutationPath"})," option is used to specify the path name (suffix) for ",(0,t.jsx)(s.code,{children:"Advanced Write Routes"}),". This option is only applicable when creating a model router and will use the value from the ",(0,t.jsx)(s.a,{href:"/docs/egose-acl/options/default-model-options/#mutationpath",children:(0,t.jsx)(s.code,{children:"default model router options - mutationPath"})})," if it is not explicitly defined."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst userRouter = egose.createRouter('User', { mutationPath: '__m__' });\n"})}),"\n",(0,t.jsx)(s.h3,{id:"idparam",children:"idParam"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"idParam"})," option is used to specify the ",(0,t.jsx)(s.code,{children:"Express Route Parameter"})," that is used to capture the ",(0,t.jsx)(s.code,{children:"Document ID"})," value. This option is only applicable when creating a model router and will use the value from the ",(0,t.jsx)(s.a,{href:"/docs/egose-acl/options/default-model-options/#idparam",children:(0,t.jsx)(s.code,{children:"default model router options - idParam"})})," if it is not explicitly defined."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst userRouter = egose.createRouter('User', { idParam: 'doc_id' });\n"})}),"\n",(0,t.jsx)(s.h3,{id:"listhardlimit",children:"listHardLimit"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"listHardLimit"})," option specifies the maximum number of documents to return from a query. It is useful for limiting the amount of data that is retrieved from the database, which can improve performance and reduce the risk of overloading the server or client. It will use the value from the ",(0,t.jsx)(s.a,{href:"/docs/egose-acl/options/default-model-options/#listhardlimit",children:(0,t.jsx)(s.code,{children:"default model router options - listHardLimit"})})," if it is not explicitly defined."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst userRouter = egose.createRouter('User', { listHardLimit: 100 });\n\n// or\n\nuserRouter.listHardLimit(100);\n\n// or\n\nuserRouter.set('listHardLimit', 100);\n"})}),"\n",(0,t.jsxs)(s.p,{children:["If the ",(0,t.jsx)(s.code,{children:"listHardLimit"})," option is set to ",(0,t.jsx)(s.code,{children:"100"})," and a request is made with a limit parameter that exceeds ",(0,t.jsx)(s.code,{children:"100"}),", the number of returned documents will be capped at ",(0,t.jsx)(s.code,{children:"100"}),"."]}),"\n",(0,t.jsx)(s.h3,{id:"permissionfield",children:"permissionField"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"permissionField"})," option specifies the name of the object field that is used to set the model permissions in the Mongoose document or document object. It will use the value from the ",(0,t.jsx)(s.a,{href:"/docs/egose-acl/options/default-model-options/#permissionfield",children:(0,t.jsx)(s.code,{children:"default model router options - permissionField"})})," if it is not explicitly defined."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst permissionField = '__access';\n\nconst userRouter = egose.createRouter('User', { permissionField });\n\n// or\n\nuserRouter.permissionField(permissionField);\n\n// or\n\nuserRouter.set('permissionField', permissionField);\n"})}),"\n",(0,t.jsx)(s.h3,{id:"mandatoryfields",children:"mandatoryFields"}),"\n",(0,t.jsxs)(s.p,{children:["With the ",(0,t.jsx)(s.code,{children:"mandatoryFields"})," option, you can specify which model fields are essential for ",(0,t.jsx)(s.code,{children:"docPermissions"})," middleware functions to operate correctly. After the middleware function, these fields are excluded and prevented from being returned to the requester, unless they are explicitly requested and authorized for viewing."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst mandatoryFields = ['role'];\n\nconst userRouter = egose.createRouter('User', { mandatoryFields });\n\n// or\n\nuserRouter.mandatoryFields(mandatoryFields);\n\n// or\n\nuserRouter.set('mandatoryFields', mandatoryFields);\n"})}),"\n",(0,t.jsx)(s.h3,{id:"identifier",children:"identifier"}),"\n",(0,t.jsxs)(s.p,{children:["The option ",(0,t.jsx)(s.code,{children:"identifier"})," defines how ",(0,t.jsx)(s.code,{children:"id param"})," is used to find the target document and will use the value from the ",(0,t.jsx)(s.a,{href:"/docs/egose-acl/options/default-model-options/#identifier",children:(0,t.jsx)(s.code,{children:"default model router options - identifier"})})," if it is not explicitly defined."]}),"\n",(0,t.jsx)(s.p,{children:"There is more than one way to define the relation:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"string"}),": Mongoose document field key"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"function"}),": Function returns a Mongoose query to find the target document."]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst identifier = function (id) {\n  return { $or: [{ _id: id }, { code: id }] };\n};\n\nconst userRouter = egose.createRouter('User', { identifier });\n\n// or\n\nuserRouter.identifier(identifier);\n\n// or\n\nuserRouter.set('identifier', identifier);\n"})}),"\n",(0,t.jsx)(s.h3,{id:"permissionschema",children:"permissionSchema"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"permissionSchema"})," option defines global and optional document permissions to resources, allowing for fine-grained control.\nIf no field-level security rule is defined for a field, by default, the field is protected for all actions (list, read, update, and create)."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst permissionSchema = {\n  name: { list: true, read: true, update: 'edit.name', create: true },\n  role: {\n    list: ['isAdmin', 'isUser'],\n    read: 'isAdmin',\n    update: function (globalPermissions, docPermissions) {\n      // `this` refers to Express request object\n      if (docPermissions['edit.role']) return true;\n      return false;\n    },\n    create: 'isAdmin',\n  },\n};\n\nconst userRouter = egose.createRouter('User', { permissionSchema });\n\n// or\n\nuserRouter.permissionSchema(permissionSchema);\n\n// or\n\nuserRouter.set('permissionSchema', permissionSchema);\n"})}),"\n",(0,t.jsx)(s.h3,{id:"docpermissions",children:"docPermissions"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"docPermissions"})," option is a feature that enables you to define the permissions for a target document. With this option, you can prepare the permission object for the document, defining whether a requester is authorized to view or modify the document, as well as the level of access they have."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst list = function (docOrObject, globalPermissions) {\n  return {\n    // processed document permissions\n  };\n};\n\nconst read = function (docOrObject, globalPermissions) {\n  return {\n    // processed document permissions\n  };\n};\n\nconst create = function (docOrObject, globalPermissions) {\n  return {\n    // processed document permissions\n  };\n};\n\nconst update = function (docOrObject, globalPermissions) {\n  return {\n    // processed document permissions\n  };\n};\n\nconst docPermissions = {\n  list,\n  read,\n  create,\n  update,\n};\n\nconst userRouter = egose.createRouter('User', { docPermissions });\n\n// or\n\nuserRouter.docPermissions(docPermissions);\n\n// or\n\nuserRouter.set('docPermissions', docPermissions);\n\n// or\n\nuserRouter.docPermissions('list', list);\nuserRouter.docPermissions('read', read);\nuserRouter.docPermissions('create', create);\nuserRouter.docPermissions('update', update);\n\n// or\n\nuserRouter.set('docPermissions.list', list);\nuserRouter.set('docPermissions.read', read);\nuserRouter.set('docPermissions.create', create);\nuserRouter.set('docPermissions.update', update);\n"})}),"\n",(0,t.jsx)(s.h3,{id:"routeguard",children:"routeGuard"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"routeGuard"})," option enables you to control access to the backend API endpoints based on the requester's global permissions. With this option, you can specify which routes are allowed and which ones are excluded, using the familiar CRUDL model (Create, Read, Update, Delete, and List)."]}),"\n",(0,t.jsxs)(s.p,{children:["By using ",(0,t.jsx)(s.code,{children:"routeGuard"}),", you can ensure that only authorized users can access and modify your data, helping to protect the confidentiality and integrity of your information."]}),"\n",(0,t.jsxs)(s.p,{children:["It will use the value from the ",(0,t.jsx)(s.a,{href:"/docs/egose-acl/options/default-model-options/#routeguard",children:(0,t.jsx)(s.code,{children:"default model router options - routeGuard"})})," if it is not explicitly defined."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst listDef = true;\nconst readDef = ['isAdmin', 'isUser'];\nconst updateDef = 'isAdmin';\nconst createDef = function (globalPermissions) {\n  if (globalPermissions.isAdmin) return true;\n  return false;\n};\nconst deleteDef = false;\n\nconst routeGuard = {\n  list: listDef,\n  read: readDef,\n  create: createDef,\n  update: updateDef,\n  delete: deleteDef,\n};\n\nconst userRouter = egose.createRouter('User', { routeGuard });\n\n// or\n\nuserRouter.routeGuard(routeGuard);\n\n// or\n\nuserRouter.set('routeGuard', routeGuard);\n\n// or\n\nuserRouter.routeGuard('list', listDef);\nuserRouter.routeGuard('read', readDef);\nuserRouter.routeGuard('create', createDef);\nuserRouter.routeGuard('update', updateDef);\nuserRouter.routeGuard('delete', deleteDef);\n\n// or\n\nuserRouter.set('routeGuard.list', listDef);\nuserRouter.set('routeGuard.read', readDef);\nuserRouter.set('routeGuard.create', createDef);\nuserRouter.set('routeGuard.update', updateDef);\nuserRouter.set('routeGuard.delete', deleteDef);\n"})}),"\n",(0,t.jsx)(s.h3,{id:"basefilter",children:"baseFilter"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"baseFilter"})," option enables you to apply ",(0,t.jsx)(s.code,{children:"document-level security"})," to control access to individual documents in a collection. With this option, you can define the permission guardrails for a given document, based on the requester's global permissions."]}),"\n",(0,t.jsxs)(s.p,{children:["Using ",(0,t.jsx)(s.code,{children:"baseFilter"})," option, you can decorate the Mongoose Query object, applying custom filtering criteria to the query results to ensure that only authorized users can view or modify the documents."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst listDef = function (globalPermissions) {\n  return true;\n};\nconst readDef = function (globalPermissions) {\n  if (globalPermissions.isAdmin) return {};\n  else return { $or: [{ _id: this.user._id }, { public: true }] };\n};\nconst updateDef = function (globalPermissions) {\n  if (globalPermissions.isAdmin) return {};\n  else return { _id: this.user._id };\n};\nconst deleteDef = function (globalPermissions) {\n  return globalPermissions.isAdmin;\n};\n\nconst baseFilter = {\n  list: listDef,\n  read: readDef,\n  update: updateDef,\n  delete: deleteDef,\n};\n\nconst userRouter = egose.createRouter('User', { baseFilter });\n\n// or\n\nuserRouter.baseFilter(baseFilter);\n\n// or\n\nuserRouter.set('baseFilter', baseFilter);\n\n// or\n\nuserRouter.baseFilter('list', listDef);\nuserRouter.baseFilter('read', readDef);\nuserRouter.baseFilter('update', updateDef);\nuserRouter.baseFilter('delete', deleteDef);\n\n// or\n\nuserRouter.set('baseFilter.list', listDef);\nuserRouter.set('baseFilter.read', readDef);\nuserRouter.set('baseFilter.update', updateDef);\nuserRouter.set('baseFilter.delete', deleteDef);\n"})}),"\n",(0,t.jsx)(s.h3,{id:"defaults",children:"defaults"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"defaults"})," option allows you to define default options for each API endpoint, which will be used unless the requester provides their own options."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst publicListArgs = {\n  select: ['name'],\n  populate: [],\n  sort: '-createdAt',\n  limit: 1000,\n  page: 1,\n  process: [],\n};\n\nconst publicListOptions = {\n  includePermissions: true,\n  includeCount: false,\n  populateAccess: 'read'\n};\n\nconst publicCreateArgs = {\n  select: ['name'],\n  populate: [],\n  process: [],\n};\n\nconst publicCreateOptions = {\n  includePermissions: true,\n  populateAccess: 'read',\n};\n\nconst publicReadArgs = {\n  select: ['name'],\n  populate: [],\n  process: [],\n};\n\nconst publicReadOptions = {\n  populateAccess: 'read',\n  includePermissions: true,\n  tryList: true,\n};\n\nconst publicUpdateArgs = {\n  select: ['name'],\n  populate: [],\n  process: [],\n};\n\nconst publicUpdateOptions = {\n  returningAll: false,\n  includePermissions: true,\n  populateAccess: 'read',\n};\n\nconst defaults = {\n  publicListArgs,\n  publicListOptions,\n  publicCreateArgs,\n  publicCreateOptions,\n  publicReadArgs,\n  publicReadOptions,\n  publicUpdateArgs,\n  publicUpdateOptions,\n};\n\nconst userRouter = egose.createRouter('User', { defaults });\n\n// or\n\nuserRouter.defaults(defaults);\n\n// or\n\nuserRouter.set('defaults', defaults);\n\n// or\n\nuserRouter.defaults('publicListArgs', publicListArgs);\nuserRouter.defaults('publicListOptions', publicListOptions);\nuserRouter.defaults('publicCreateArgs', publicCreateArgs);\nuserRouter.defaults('publicCreateOptions', publicCreateOptions);\nuserRouter.defaults('publicReadArgs', publicReadArgs);\nuserRouter.defaults('publicReadOptions', publicReadOptions);\nuserRouter.defaults('publicUpdateArgs', publicUpdateArgs);\nuserRouter.defaults('publicUpdateOptions', publicUpdateOptions);\n\n// or\n\nuserRouter.set('defaults.publicListArgs', publicListArgs);\nuserRouter.set('defaults.publicListOptions', publicListOptions);\nuserRouter.set('defaults.publicCreateArgs', publicCreateArgs);\nuserRouter.set('defaults.publicCreateOptions', publicCreateOptions);\nuserRouter.set('defaults.publicReadArgs', publicReadArgs);\nuserRouter.set('defaults.publicReadOptions', publicReadOptions);\nuserRouter.set('defaults.publicUpdateArgs', publicUpdateArgs);\nuserRouter.set('defaults.publicUpdateOptions', publicUpdateOptions);\n"})})]})}function c(e={}){const{wrapper:s}={...(0,o.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}}}]);