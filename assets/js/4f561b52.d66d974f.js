"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8962],{4961:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>d,toc:()=>c});var r=n(5893),a=n(1151);n(4866),n(5162),n(9286);const o={sidebar_position:3},s="Model Middleware",d={id:"egose-acl/options/model-middleware",title:"Model Middleware",description:"Middleware functions for Model Routers",source:"@site/docs/egose-acl/options/model-middleware.mdx",sourceDirName:"egose-acl/options",slug:"/egose-acl/options/model-middleware",permalink:"/docs/egose-acl/options/model-middleware",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"aclSidebar",previous:{title:"Model Router Options",permalink:"/docs/egose-acl/options/model-options"},next:{title:"Workflow Lifecycle",permalink:"/docs/egose-acl/crud-lifecycle/"}},i={},c=[{value:"Middleware functions for Model Routers",id:"middleware-functions-for-model-routers",level:2},{value:"validate",id:"validate",level:3},{value:"prepare",id:"prepare",level:3},{value:"transform",id:"transform",level:3},{value:"decorate",id:"decorate",level:3},{value:"decorateAll",id:"decorateall",level:3},{value:"Availability in CRUD Operations",id:"availability-in-crud-operations",level:2}];function l(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"model-middleware",children:"Model Middleware"})}),"\n","\n",(0,r.jsx)(t.h2,{id:"middleware-functions-for-model-routers",children:"Middleware functions for Model Routers"}),"\n",(0,r.jsx)(t.p,{children:"Middleware functions, also known as hooks, are functions that execute during the lifecycle of asynchronous data model CRUD operations. These functions have the capability to intercept and modify requests and responses as they move through the application, offering developers a powerful means of adding custom logic, such as validation and data transformation, without altering the core application logic."}),"\n",(0,r.jsx)(t.p,{children:"Middleware functions are also part of the model router's options and the way to define them is also the same."}),"\n",(0,r.jsxs)(t.p,{children:["Please note that if you want to access the ",(0,r.jsx)(t.code,{children:"Express Request Object"})," inside your middleware functions, you should use ",(0,r.jsx)(t.code,{children:"regular functions"})," instead of ",(0,r.jsx)(t.code,{children:"arrow functions"}),". Arrow functions do not have their own ",(0,r.jsx)(t.code,{children:"this"})," value, so you cannot reference the ",(0,r.jsx)(t.code,{children:"this"})," keyword to access the ",(0,r.jsx)(t.code,{children:"Request Object"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"validate",children:"validate"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"validate"})," hooks enables you to apply custom logic to validate the data that comes from the requester before it is consumed by the further lifecycle middleware functions. With this option, you can define a set of rules or conditions that must be satisfied before the data is processed, helping to ensure the accuracy and integrity of your data."]}),"\n",(0,r.jsx)(t.p,{children:"Using validate, you can perform a wide range of checks and validations, such as data type validation, format validation, and business rule validation."}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"validate"})," hooks are available in both ",(0,r.jsx)(t.code,{children:"create"})," and ",(0,r.jsx)(t.code,{children:"update"})," operations and can be defined as individual hooks or as an object with separate functions for create and update."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst create = function (dataObject, globalPermissions) {\n  const hasName = !!dataObject.name;\n  return hasName;\n};\n\nconst update = function (dataObject, globalPermissions) {\n  return true;\n};\n\nconst validate = {\n  create,\n  update,\n};\n\nconst userRouter = egose.createRouter('User', { validate });\n\n// or\n\nuserRouter.validate(validate);\n\n// or\n\nuserRouter.set('validate', validate);\n\n// or\n\nuserRouter.validate('create', create);\nuserRouter.validate('update', update);\n\n// or\n\nuserRouter.set('validate.create', create);\nuserRouter.set('validate.update', update);\n"})}),"\n",(0,r.jsx)(t.h3,{id:"prepare",children:"prepare"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"prepare"})," hooks enables you to apply custom logic to modify the data that comes from the requester before it is merged into the current document. With this option, you can update or add additional data fields, manipulate the data format or structure, or perform other types of data transformation."]}),"\n",(0,r.jsxs)(t.p,{children:["Using ",(0,r.jsx)(t.code,{children:"prepare"}),", you can perform a wide range of data processing and transformation tasks, such as data validation, data normalization, data enrichment, or data mapping. This feature can be especially useful in scenarios where you need to ensure the consistency and quality of your data."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"prepare"})," hooks are available in both ",(0,r.jsx)(t.code,{children:"create"})," and ",(0,r.jsx)(t.code,{children:"update"})," operations and can be defined as individual hooks or as an object with separate functions for create and update."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst create = function (dataObject, globalPermissions) {\n  dataObject.createdBy = this.user._id;\n  return dataObject;\n};\n\nconst update = function (dataObject, globalPermissions) {\n  dataObject.name = dataObject.name.trim();\n  return dataObject;\n};\n\nconst prepare = {\n  create,\n  update,\n};\n\nconst userRouter = egose.createRouter('User', { prepare });\n\n// or\n\nuserRouter.prepare(prepare);\n\n// or\n\nuserRouter.set('prepare', prepare);\n\n// or\n\nuserRouter.prepare('create', create);\nuserRouter.prepare('update', update);\n\n// or\n\nuserRouter.set('prepare.create', create);\nuserRouter.set('prepare.update', update);\n"})}),"\n",(0,r.jsx)(t.h3,{id:"transform",children:"transform"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"transform"})," hook allows you to apply process logic to modify the Mongoose document after the raw data has been merged into the current document. This hook is particularly useful for finalizing the updated document before the changes are saved in the database."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"transform"})," hook is only available for the update operation."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst transform = function (doc, globalPermissions) {\n  doc.updateAuditFields(this.user);\n  return doc;\n};\n\nconst userRouter = egose.createRouter('User', { transform });\n\n// or\n\nuserRouter.transform(transform);\n\n// or\n\nuserRouter.set('transform', transform);\n"})}),"\n",(0,r.jsx)(t.h3,{id:"decorate",children:"decorate"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"decorate"})," hooks are invoked prior to sending the response data to the requester. They are utilized for processing raw data and applying custom logic before returning the result."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"decorate"})," hook are available in ",(0,r.jsx)(t.code,{children:"list"}),", ",(0,r.jsx)(t.code,{children:"read"}),", ",(0,r.jsx)(t.code,{children:"create"}),", and ",(0,r.jsx)(t.code,{children:"update"})," operations and can be defined as individual hooks or as an object with separate functions."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst list = function (dataObject, globalPermissions) {\n  dataObject._context = 'list';\n  return dataObject;\n};\n\nconst read = function (dataObject, globalPermissions) {\n  dataObject._context = 'read';\n  return dataObject;\n};\n\nconst create = function (dataObject, globalPermissions) {\n  dataObject._context = 'create';\n  return dataObject;\n};\n\nconst update = function (dataObject, globalPermissions) {\n  dataObject._context = 'update';\n  return dataObject;\n};\n\nconst decorate = {\n  list,\n  read,\n  create,\n  update,\n};\n\nconst userRouter = egose.createRouter('User', { decorate });\n\n// or\n\nuserRouter.decorate(decorate);\n\n// or\n\nuserRouter.set('decorate', decorate);\n\n// or\n\nuserRouter.decorate('list', list);\nuserRouter.decorate('read', read);\nuserRouter.decorate('create', create);\nuserRouter.decorate('update', update);\n\n// or\n\nuserRouter.set('decorate', decorate);\nuserRouter.set('decorate.list', list);\nuserRouter.set('decorate.read', read);\nuserRouter.set('decorate.create', create);\nuserRouter.set('decorate.update', update);\n"})}),"\n",(0,r.jsx)(t.h3,{id:"decorateall",children:"decorateAll"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"decorateAll"})," hook is invoked prior to sending the response data in the ",(0,r.jsx)(t.code,{children:"list"})," operation. It is used for processing and filtering multiple document objects before returning the result. It's important to note that the ",(0,r.jsx)(t.code,{children:"decorateAll"})," hook runs after the ",(0,r.jsx)(t.code,{children:"decorate"})," middleware has executed."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"decorateAll"})," hook is only available for the ",(0,r.jsx)(t.code,{children:"update"})," operation."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:"import egose from '@egose/acl';\n\nconst decorateAll = function (docObjects, globalPermissions) {\n  return omitInvalidDocs(docObjects);\n};\n\nconst userRouter = egose.createRouter('User', { decorateAll });\n\n// or\n\nuserRouter.decorateAll(decorateAll);\n\n// or\n\nuserRouter.set('decorateAll', decorateAll);\n"})}),"\n",(0,r.jsx)(t.h2,{id:"availability-in-crud-operations",children:"Availability in CRUD Operations"}),"\n",(0,r.jsx)(t.p,{children:"Each middleware function is available in the following CRUD operations:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Middleware"}),(0,r.jsx)(t.th,{children:"List"}),(0,r.jsx)(t.th,{children:"Read"}),(0,r.jsx)(t.th,{children:"Create"}),(0,r.jsx)(t.th,{children:"Update"}),(0,r.jsx)(t.th,{children:"Delete"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Validate"}),(0,r.jsx)(t.td,{}),(0,r.jsx)(t.td,{}),(0,r.jsx)(t.td,{children:"\u2713"}),(0,r.jsx)(t.td,{children:"\u2713"}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Prepare"}),(0,r.jsx)(t.td,{}),(0,r.jsx)(t.td,{}),(0,r.jsx)(t.td,{children:"\u2713"}),(0,r.jsx)(t.td,{children:"\u2713"}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Transform"}),(0,r.jsx)(t.td,{}),(0,r.jsx)(t.td,{}),(0,r.jsx)(t.td,{}),(0,r.jsx)(t.td,{children:"\u2713"}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Decorate"}),(0,r.jsx)(t.td,{children:"\u2713"}),(0,r.jsx)(t.td,{children:"\u2713"}),(0,r.jsx)(t.td,{children:"\u2713"}),(0,r.jsx)(t.td,{children:"\u2713"}),(0,r.jsx)(t.td,{})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Decorate All"}),(0,r.jsx)(t.td,{children:"\u2713"}),(0,r.jsx)(t.td,{}),(0,r.jsx)(t.td,{}),(0,r.jsx)(t.td,{}),(0,r.jsx)(t.td,{})]})]})]})]})}function u(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);