"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8021],{2305:(e,i,l)=>{l.r(i),l.d(i,{assets:()=>t,contentTitle:()=>r,default:()=>j,frontMatter:()=>c,metadata:()=>d,toc:()=>o});var n=l(5893),s=l(1151);l(4866),l(5162),l(9286);const c={sidebar_position:3},r="Update",d={id:"egose-acl/crud-lifecycle/update",title:"Update",description:"Update operation executes hook methods in the following sequence:",source:"@site/docs/egose-acl/crud-lifecycle/update.mdx",sourceDirName:"egose-acl/crud-lifecycle",slug:"/egose-acl/crud-lifecycle/update",permalink:"/docs/egose-acl/crud-lifecycle/update",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"aclSidebar",previous:{title:"Create",permalink:"/docs/egose-acl/crud-lifecycle/create"},next:{title:"API Specifications for CRUD Operations",permalink:"/docs/egose-acl/api-endpoints/"}},t={},o=[{value:"Configuration Example",id:"configuration-example",level:3}];function a(e){const i={code:"code",h1:"h1",h3:"h3",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h1,{id:"update",children:"Update"}),"\n","\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"Update"})," operation executes hook methods in the following sequence:"]}),"\n",(0,n.jsxs)("table",{children:[(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Hook"}),(0,n.jsx)("th",{children:"Parameters"}),(0,n.jsx)("th",{children:"Description"})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"docPermissions"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("ol",{children:[(0,n.jsx)("li",{children:"Mongoose document"}),(0,n.jsx)("li",{children:"global permissions"})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("ul",{children:(0,n.jsx)("li",{children:"called after Mongoose execute the query"})})})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"validate"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("ol",{children:[(0,n.jsx)("li",{children:"allowed data object"}),(0,n.jsx)("li",{children:"global permissions"}),(0,n.jsxs)("li",{children:["context object:",(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"originalDocObject"}),(0,n.jsx)("li",{children:"originalData"}),(0,n.jsx)("li",{children:"currentDoc"})]})]})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("ul",{})})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"prepare"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("ol",{children:[(0,n.jsx)("li",{children:"allowed data object"}),(0,n.jsx)("li",{children:"global permissions"}),(0,n.jsxs)("li",{children:["context object:",(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"originalDocObject"}),(0,n.jsx)("li",{children:"originalData"}),(0,n.jsx)("li",{children:"currentDoc"})]})]})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("ul",{})})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"transform"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("ol",{children:[(0,n.jsx)("li",{children:"allowed data object"}),(0,n.jsx)("li",{children:"global permissions"}),(0,n.jsxs)("li",{children:["context object:",(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"originalDocObject"}),(0,n.jsx)("li",{children:"originalData"}),(0,n.jsx)("li",{children:"currentDoc"}),(0,n.jsx)("li",{children:"preparedData"}),(0,n.jsx)("li",{children:"modifiedPaths"})]})]})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("ul",{children:(0,n.jsx)("li",{children:"called before changes saved"})})})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"docPermissions"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("ol",{children:[(0,n.jsx)("li",{children:"Mongoose document"}),(0,n.jsx)("li",{children:"global permissions"}),(0,n.jsxs)("li",{children:["context object:",(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"originalDocObject"}),(0,n.jsx)("li",{children:"originalData"}),(0,n.jsx)("li",{children:"currentDoc"}),(0,n.jsx)("li",{children:"preparedData"}),(0,n.jsx)("li",{children:"modifiedPaths"})]})]})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("ul",{children:(0,n.jsx)("li",{children:"called after changes saved"})})})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("code",{children:"decorate"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("ol",{children:[(0,n.jsx)("li",{children:"plain document object"}),(0,n.jsx)("li",{children:"global permissions"}),(0,n.jsxs)("li",{children:["context object:",(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"originalDocObject"}),(0,n.jsx)("li",{children:"originalData"}),(0,n.jsx)("li",{children:"currentDoc"}),(0,n.jsx)("li",{children:"preparedData"}),(0,n.jsx)("li",{children:"modifiedPaths"})]})]})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("ul",{})})]})]}),"\n",(0,n.jsx)(i.h3,{id:"configuration-example",children:"Configuration Example"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-ts",children:"modelRouter.validate('update', function (dataObject, globalPermissions) {\n  return true;\n});\n\nmodelRouter.prepare('update', function (dataObject, globalPermissions) {\n  dataObject.name = dataObject.name.trim();\n  return dataObject;\n});\n\nmodelRouter.transform(function (doc, globalPermissions) {\n  return doc;\n});\n\nmodelRouter.docPermissions('update', function (doc, globalPermissions) {\n  const isMe = String(doc._id) === String(this.user._id);\n\n  return {\n    'edit.name': globalPermissions.isAdmin || isMe,\n    'edit.role': globalPermissions.isAdmin,\n  };\n});\n\nmodelRouter.decorate('update', function (docObject, globalPermissions) {\n  docObject.decoratedBy = 'egose';\n  return docObject;\n});\n"})})]})}function j(e={}){const{wrapper:i}={...(0,s.a)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}}}]);